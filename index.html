<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stack Tags Predictor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      margin-top: 50px;
      background: #fff;
      padding: 25px 30px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 500px;
    }
    h3 {
      margin-bottom: 20px;
      font-weight: 600;
      color: #333;
      font-size: 20px;
      border-bottom: 1px solid #e4e6e8;
      padding-bottom: 10px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #444;
    }
    input, textarea {
      width: 100%;
      border: 1px solid #c4c8cc;
      border-radius: 4px;
      padding: 10px;
      font-size: 14px;
      margin-bottom: 16px;
      box-sizing: border-box;
      font-family: inherit;
    }
    input:focus, textarea:focus {
      border-color: #0a95ff;
      outline: none;
      box-shadow: 0 0 0 3px rgba(10,149,255,0.2);
    }
    button {
      background-color: #0a95ff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 500;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0074cc;
    }
    pre {
      background: #f6f6f6;
      padding: 12px;
      border-radius: 4px;
      border: 1px solid #ddd;
      margin-top: 20px;
      font-size: 14px;
      max-height: 250px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    #manual-tags {
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3>Stack Tags Predictor</h3>
    
    <label for="title">Title</label>
    <input id="title" placeholder="Enter your question title here">
    
    <label for="body">Body</label>
    <textarea id="body" placeholder="Describe your problem..."></textarea>
    
    <button onclick="predict()">Predict Tags</button>
    
    <div id="predicted-tags-container" style="display:none;">
      <label for="predicted-tags">Predicted Tags</label>
      <input id="predicted-tags" readonly>
      
      <label for="manual-tags">Add Manual Tags (comma separated)</label>
      <input id="manual-tags" placeholder="e.g., php,mysql,api">
      
      <button onclick="finalize()">Finalize Post</button>
    </div>
    
    <pre id="out"></pre>
  </div>
  
  <script>
    let raw_output = "";

    async function predict(){
      const res = await fetch('http://localhost:5000/predict', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          title: document.getElementById('title').value,
          body: document.getElementById('body').value
        })
      });
      const data = await res.json();
      if(data.error){
        document.getElementById('out').textContent = "Error: " + data.error;
        return;
      }

      // Show predicted tags in <tag><tag> format
      document.getElementById('predicted-tags').value = data.predicted_tags;
      raw_output = data.raw_output;

      // Show manual tag input
      document.getElementById('predicted-tags-container').style.display = 'block';
      document.getElementById('out').textContent = "Predicted tags ready. You can add manual tags before finalizing.";
    }

    async function finalize(){
      const predictedTagsInput = document.getElementById('predicted-tags').value;
      const manualTagsInput = document.getElementById('manual-tags').value;

      // Convert both predicted and manual tags into array
      const predictedTags = [...predictedTagsInput.matchAll(/<([^>]+)>/g)].map(m => m[1].trim());
      const manualTags = manualTagsInput.split(",").map(t => t.trim()).filter(t=>t);

      const finalTags = [...predictedTags, ...manualTags];

      const res = await fetch('http://localhost:5000/finalize', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          title: document.getElementById('title').value,
          body: document.getElementById('body').value,
          tags: finalTags,
          raw_output: raw_output
        })
      });

      const data = await res.json();
      if(data.error){
        document.getElementById('out').textContent = "Error: " + data.error;
        return;
      }

      document.getElementById('out').textContent = 
        `Post Saved!\nPost ID: ${data.post_id}\nFinal Tags: ${data.final_tags}\nNew Tags Saved: ${data.new_tags_saved || "None"}`;

      // Clear manual tags input
      document.getElementById('manual-tags').value = '';
    }
  </script>
</body>
</html>
